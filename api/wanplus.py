import requests
import json
from bs4 import BeautifulSoup
from selenium import webdriver
from selenium.webdriver.support.ui import Select
import time

"""
This api mainly focus on fetching the performance measurement statistics on msi play.
It is intergrated to api by static data as the server response from wanplus is very slow and all data were settled.
"""
class WanPlusMsi():
    def __init__(self):
        _PATH = 'C:/Program Files (x86)/chromedriver.exe'
        # _site = 'http://www.wanplus.com/ajax/stats/list'
        opt = webdriver.ChromeOptions()
        opt.add_argument('--headless')
        # Mazimize the window, for the website does not display full data by the minizied screen
        opt.add_argument("--start-maximized");
        self.driver = webdriver.Chrome(_PATH, options=opt)
        self.driver.get("http://www.wanplus.com/lol/teamstats")
        time.sleep(2)
        selectEvent = Select(self.driver.find_element_by_name('event'))
        selectEvent.select_by_value("1035")
        time.sleep(0.5)

    def getAllTeamStats(self):
        # table 1 for attacking and gold collecting is arranged as:
        # | order | teamname | kda | killsPergame | deathsPergame | damagetoheroPermin | fstbloodpercentage | avgDuration | goldpermatch | goldsPermin | lasthitPermin |
        # table 2 for warding and resource control is arranged as:
        # | order | teamname | dragonkillsPergame | dragonkillspercentage | baronkillsPergame | baronkillspercentage | wardsplacedpermin | wardskilledpermin | wardskilledrate | towertakensPergame | towerdeathsPergame |
        table1 = self.tableToArray()
        tab = self.driver.find_element_by_class_name('detail-list-title').find_elements_by_css_selector('div')[1]
        tab.click()
        table2 = self.tableToArray()
        return [table1, table2]

    def getAllPlayerStats(self):
        # table 3 for k/d/a statistics is arranged as:
        # | order | playername | teamname | role | appearedTimes | kda | attendrate | killsPergame | mostkills | deathsPergame | mostdeaths | assistsPergame |
        # table 4 for farming and team contribution is arranged as:
        # | order | playername | mostassists | goldsPermin | lasthitPermin | damagetoheroPermin | damagetoheroPercent | damagetakenPermin | damagetakenPercent | wardsplacedPermin | wardskilledPermin |
        link = self.driver.find_element_by_xpath('//*[@href="/lol/playerstats"]')
        link.click()
        time.sleep(0.5)
        selectEvent = Select(self.driver.find_element_by_name('event'))
        selectEvent.select_by_value("1035")
        time.sleep(0.5)
        table3 = self.getPaginatedTable()
        tab2 = self.driver.find_element_by_class_name('detail-list-title').find_elements_by_css_selector('div')[1]
        tab2.click()
        table4 = self.getPaginatedTable()
        return [table3, table4]

    def getAllStats(self):
        lst1 = self.getAllTeamStats()
        lst2 = self.getAllPlayerStats()
        return {
            "playerT1": lst2[0],
            "playerT2": lst2[1],
            "teamT1": lst1[0],
            "teamT2": lst1[1]
        }

    def getPaginatedTable(self):
        start = 1
        end = len(self.driver.find_elements_by_class_name('paginate_button ')) - 1
        table = []
        while (start < end):
            btn = self.driver.find_elements_by_class_name('paginate_button ')[start]
            btn.click()
            time.sleep(0.5)
            tb = self.tableToArray()
            table += tb
            start += 1
        return table

    def tableToArray(self):
        stats = []
        dataTable = self.driver.find_element_by_id('DataTables_Table_0')
        lines = dataTable.find_elements_by_css_selector('tr')
        for line in lines:
            data = line.find_elements_by_css_selector('td')
            if len(data) != 0:
                dt = []
                for item in data:
                    if item.text != '':
                        dt.append(self.chineseTransformer(item.text))
                stats.append(dt)
        return stats

    def chineseTransformer(self, str):
        if str == '打野':
            return "Jungle"
        elif str == '上单':
            return "Top"
        elif str == '中单':
            return "Mid"
        elif str == '辅助':
            return "Support"
        else:
            return str

STATIC_DATA = {
    'playerT1': [
        ['1', 'Ming', 'RNG', 'Support', '27', '4.2', '67.4%', '0.9', '4', '2.8', '7', '10.6'],
        ['2', 'GALA', 'RNG', 'ADC', '27', '5.7', '65.7%', '6.2', '11', '2.0', '8', '5.1'],
        ['3', 'Wei', 'RNG', 'Jungle', '27', '4.8', '67.0%', '3.2', '10', '2.4', '6', '8.3'],
        ['4', 'Khan', 'DK', 'Top', '26', '4.0', '64.2%', '3.2', '7', '2.4', '8', '6.3'],
        ['5', 'Xiaohu', 'RNG', 'Top', '26', '4.1', '58.5%', '2.9', '10', '2.4', '5', '7.0'],
        ['6', 'Ghost', 'DK', 'ADC', '26', '5.6', '64.4%', '5.3', '10', '1.7', '5', '4.3'],
        ['7', 'Cryin', 'RNG', 'Mid', '26', '4.1', '67.3%', '3.7', '11', '2.8', '6', '7.8'],
        ['8', 'Canyon', 'DK', 'Jungle', '26', '5.1', '69.8%', '2.5', '6', '2.0', '6', '8.0'],
        ['9', 'ShowMaker', 'DK', 'Mid', '26', '6.8', '68.8%', '3.4', '8', '1.5', '7', '6.8'],
        ['10', 'BeryL', 'DK', 'Support', '26', '2.3', '57.5%', '0.5', '2', '3.7', '9', '8.1'],
        ['11', 'Humanoid', 'MAD', 'Mid', '21', '2.9', '57.1%', '3.1', '10', '3.0', '8', '5.5'],
        ['12', 'Armut', 'MAD', 'Top', '21', '3.5', '59.2%', '2.7', '6', '2.6', '10', '6.3'],
        ['13', 'Carzzy', 'MAD', 'ADC', '21', '3.8', '64.6%', '5.0', '11', '2.6', '6', '4.9'],
        ['14', 'Kaiser', 'MAD', 'Support', '21', '3.0', '66.8%', '1.1', '3', '3.3', '7', '9.0'],
        ['15', 'Elyoya', 'MAD', 'Jungle', '21', '4.6', '66.5%', '3.3', '8', '2.2', '5', '6.8'],
        ['16', 'Maple', 'PSG', 'Mid', '20', '4.7', '63.0%', '3.8', '9', '2.1', '6', '6.2'],
        ['17', 'Kaiwing', 'PSG', 'Support', '20', '3.5', '69.3%', '0.7', '4', '3.2', '7', '10.3'],
        ['18', 'Hanabi', 'PSG', 'Top', '20', '3.5', '53.3%', '2.5', '6', '2.5', '6', '6.0'],
        ['19', 'River', 'PSG', 'Jungle', '20', '5.2', '70.5%', '3.5', '8', '2.1', '4', '7.8'],
        ['20', 'Doggo', 'PSG', 'ADC', '20', '6.1', '70.8%', '5.5', '13', '1.9', '5', '5.8'],
        ['21', 'Pabu', 'PGG', 'Jungle', '19', '1.9', '67.8%', '1.8', '8', '3.3', '7', '4.4'],
        ['22', 'Praedyth', 'PGG', 'ADC', '19', '1.7', '62.6%', '2.7', '9', '3.5', '7', '3.0'],
        ['23', 'Biopanther', 'PGG', 'Top', '19', '1.6', '58.0%', '1.6', '8', '3.4', '7', '3.7'],
        ['24', 'Chazz', 'PGG', 'Mid', '19', '1.6', '62.1%', '2.6', '10', '3.6', '10', '3.1'],
        ['25', 'Decoy', 'PGG', 'Support', '19', '1.7', '67.8%', '0.4', '2', '3.7', '11', '5.8'],
        ['26', 'Perkz', 'C9', 'Mid', '16', '3.2', '63.1%', '3.7', '11', '2.9', '6', '5.6'],
        ['27', 'Zven', 'C9', 'ADC', '16', '4.0', '57.2%', '3.5', '7', '2.1', '5', '4.9'],
        ['28', 'Vulcan', 'C9', 'Support', '16', '2.7', '63.1%', '0.8', '4', '3.4', '9', '8.6'],
        ['29', 'Blaber', 'C9', 'Jungle', '16', '4.6', '71.6%', '3.1', '10', '2.3', '5', '7.4'],
        ['30', 'Fudge', 'C9', 'Top', '16', '3.2', '60.2%', '3.7', '10', '2.8', '7', '5.2'],
        ['31', 'SaNTaS', 'UOL', 'Support', '9', '1.2', '59.2%', '0.6', '1', '4.0', '9', '4.1'],
        ['32', 'BOSS', 'UOL', 'Top', '9', '1.4', '60.6%', '2.1', '6', '3.3', '7', '2.7'],
        ['33', 'Lodik', 'UOL', 'ADC', '9', '1.9', '54.9%', '1.6', '4', '2.3', '5', '2.8'],
        ['34', 'AHaHaCiK', 'UOL', 'Jungle', '9', '1.4', '64.8%', '1.2', '3', '3.8', '7', '3.9'],
        ['35', 'Nomanz', 'UOL', 'Mid', '9', '1.8', '73.2%', '2.4', '7', '3.2', '5', '3.3'],
        ['36', 'HolyPhoeni...', 'IW', 'ADC', '6', '4.1', '76.9%', '6.8', '9', '2.8', '5', '4.8'],
        ['37', 'Whitelotus', 'INF', 'ADC', '6', '2.1', '61.5%', '2.2', '8', '2.5', '3', '3.2'],
        ['38', 'Steal', 'DFM', 'Jungle', '6', '4.5', '80.6%', '2.5', '4', '2.2', '4', '7.2'],
        ['39', 'Luci', 'PNG', 'Support', '6', '1.3', '61.8%', '0.5', '1', '5.3', '7', '6.5'],
        ['40', 'Yutapon', 'DFM', 'ADC', '6', '4.2', '52.8%', '2.8', '7', '1.5', '2', '3.5'],
        ['41', 'Evi', 'DFM', 'Top', '6', '2.8', '65.3%', '4.2', '11', '2.8', '5', '3.7'],
        ['42', 'Kazu', 'DFM', 'Support', '6', '1.3', '45.8%', '0.0', '0', '4.2', '6', '5.5'],
        ['43', 'tinowns', 'PNG', 'Mid', '6', '3.3', '58.8%', '2.5', '7', '2.0', '3', '4.2'],
        ['44', 'Robo', 'PNG', 'Top', '6', '1.5', '63.2%', '3.5', '10', '4.7', '9', '3.7'],
        ['45', 'brTT', 'PNG', 'ADC', '6', '1.7', '57.4%', '2.8', '10', '3.8', '6', '3.7'],
        ['46', 'SolidSnake', 'INF', 'Jungle', '6', '2.0', '73.1%', '2.5', '4', '3.2', '5', '3.8'],
        ['47', 'Buggax', 'INF', 'Top', '6', '0.9', '51.9%', '1.5', '3', '5.2', '11', '3.0'],
        ['48', 'Aria', 'DFM', 'Mid', '6', '3.9', '54.2%', '2.5', '5', '1.7', '4', '4.0'],
        ['49', 'cody', 'INF', 'Mid', '6', '1.6', '50.0%', '1.5', '5', '2.7', '5', '2.8'],
        ['50', 'Farfetch', 'IW', 'Support', '6', '1.4', '61.5%', '0.8', '1', '6.5', '10', '8.5'],
        ['51', 'StarScreen', 'IW', 'Top', '6', '1.6', '54.9%', '2.5', '7', '5.2', '7', '5.8'],
        ['52', 'Ferret', 'IW', 'Jungle', '6', '2.0', '56.0%', '2.5', '4', '4.3', '5', '6.0'],
        ['53', 'Serin', 'IW', 'Mid', '6', '3.4', '63.7%', '2.5', '3', '2.8', '4', '7.2'],
        ['54', 'CarioK', 'PNG', 'Jungle', '6', '2.4', '67.6%', '2.0', '6', '3.2', '5', '5.7'],
        ['55', 'Ackerman', 'INF', 'Support', '6', '2.1', '75.0%', '1.0', '2', '3.2', '7', '5.5'],
        ['56', 'Xiaohu', 'RNG', 'Mid', '1', '16.0', '72.7%', '13.0', '13', '0.0', '0', '3.0'],
        ['57', 'Xiaobai', 'RNG', 'Top', '1', '10.0', '45.5%', '2.0', '2', '0.0', '0', '8.0']
    ],
    'playerT2': [
        ['1', 'Ming', '19', '252', '1.21', '141', '7.0%', '407', '14.8%', '1.62', '0.35'],
        ['2', 'GALA', '13', '479', '10.04', '577', '28.7%', '414', '15.0%', '0.51', '0.40'],
        ['3', 'Wei', '14', '355', '6.12', '370', '18.4%', '833', '30.2%', '0.74', '0.49'],
        ['4', 'Khan', '13', '400', '7.92', '496', '23.5%', '736', '26.0%', '0.48', '0.23'],
        ['5', 'Xiaohu', '18', '419', '8.24', '425', '21.2%', '604', '21.9%', '0.46', '0.23'],
        ['6', 'Ghost', '10', '443', '8.92', '495', '23.5%', '396', '14.0%', '0.79', '0.37'],
        ['7', 'Cryin', '16', '401', '8.23', '491', '24.5%', '511', '18.5%', '0.39', '0.20'],
        ['8', 'Canyon', '14', '358', '6.79', '400', '19.0%', '823', '29.1%', '0.54', '0.34'],
        ['9', 'ShowMaker', '14', '421', '8.92', '570', '27.0%', '418', '14.8%', '0.46', '0.28'],
        ['10', 'BeryL', '14', '238', '1.53', '147', '7.0%', '454', '16.1%', '1.57', '0.49'],
        ['11', 'Humanoid', '14', '413', '8.98', '567', '27.9%', '461', '16.7%', '0.43', '0.22'],
        ['12', 'Armut', '12', '384', '7.95', '442', '21.8%', '649', '23.5%', '0.47', '0.25'],
        ['13', 'Carzzy', '12', '461', '9.56', '565', '27.8%', '432', '15.6%', '0.72', '0.47'],
        ['14', 'Kaiser', '19', '242', '1.10', '154', '7.6%', '413', '14.9%', '1.62', '0.36'],
        ['15', 'Elyoya', '15', '347', '6.05', '303', '14.9%', '810', '29.3%', '0.50', '0.39'],
        ['16', 'Maple', '13', '379', '7.99', '473', '25.7%', '488', '17.8%', '0.44', '0.20'],
        ['17', 'Kaiwing', '18', '240', '1.24', '128', '7.0%', '375', '13.7%', '1.57', '0.38'],
        ['18', 'Hanabi', '12', '384', '8.10', '404', '21.9%', '628', '22.9%', '0.45', '0.31'],
        ['19', 'River', '14', '340', '5.73', '325', '17.7%', '813', '29.7%', '0.49', '0.46'],
        ['20', 'Doggo', '14', '478', '10.31', '510', '27.7%', '437', '16.0%', '0.78', '0.47'],
        ['21', 'Pabu', '13', '321', '6.16', '306', '18.9%', '872', '29.4%', '0.38', '0.39'],
        ['22', 'Praedyth', '10', '368', '7.66', '418', '25.9%', '493', '16.6%', '0.54', '0.24'],
        ['23', 'Biopanther', '12', '352', '7.79', '338', '20.9%', '630', '21.2%', '0.50', '0.13'],
        ['24', 'Chazz', '12', '370', '8.14', '403', '25.0%', '548', '18.5%', '0.32', '0.13'],
        ['25', 'Decoy', '18', '224', '1.52', '151', '9.3%', '426', '14.3%', '1.11', '0.30'],
        ['26', 'Perkz', '13', '410', '8.99', '531', '28.4%', '547', '18.5%', '0.55', '0.36'],
        ['27', 'Zven', '11', '416', '9.02', '497', '26.5%', '379', '12.8%', '0.53', '0.40'],
        ['28', 'Vulcan', '18', '232', '1.32', '138', '7.4%', '426', '14.4%', '1.54', '0.31'],
        ['29', 'Blaber', '14', '345', '6.48', '324', '17.3%', '870', '29.4%', '0.35', '0.40'],
        ['30', 'Fudge', '12', '381', '7.85', '383', '20.5%', '733', '24.8%', '0.55', '0.16'],
        ['31', 'SaNTaS', '9', '217', '1.33', '113', '7.2%', '458', '16.9%', '1.44', '0.33'],
        ['32', 'BOSS', '8', '365', '7.56', '348', '22.2%', '539', '19.9%', '0.40', '0.21'],
        ['33', 'Lodik', '6', '359', '8.19', '283', '18.0%', '355', '13.1%', '0.32', '0.20'],
        ['34', 'AHaHaCiK', '8', '313', '5.99', '289', '18.4%', '881', '32.6%', '0.23', '0.34'],
        ['35', 'Nomanz', '9', '382', '8.81', '536', '34.1%', '473', '17.5%', '0.40', '0.18'],
        ['36', 'HolyPhoeni...', '8', '489', '9.68', '501', '26.8%', '503', '16.7%', '0.31', '0.35'],
        ['37', 'Whitelotus', '6', '403', '9.74', '352', '22.1%', '419', '15.1%', '0.93', '0.44'],
        ['38', 'Steal', '13', '349', '6.08', '226', '14.8%', '887', '31.7%', '0.49', '0.48'],
        ['39', 'Luci', '15', '218', '1.19', '113', '6.9%', '463', '14.9%', '1.73', '0.34'],
        ['40', 'Yutapon', '6', '414', '9.71', '321', '20.9%', '372', '13.3%', '0.73', '0.36'],
        ['41', 'Evi', '6', '392', '7.40', '445', '29.0%', '670', '24.0%', '0.30', '0.26'],
        ['42', 'Kazu', '13', '215', '1.16', '119', '7.8%', '449', '16.0%', '1.37', '0.41'],
        ['43', 'tinowns', '11', '371', '8.17', '476', '28.8%', '449', '14.5%', '0.51', '0.24'],
        ['44', 'Robo', '9', '402', '7.81', '456', '27.7%', '802', '25.8%', '0.48', '0.18'],
        ['45', 'brTT', '10', '405', '8.64', '389', '23.6%', '460', '14.8%', '0.37', '0.30'],
        ['46', 'SolidSnake', '6', '322', '5.78', '261', '16.4%', '811', '29.2%', '0.38', '0.44'],
        ['47', 'Buggax', '4', '358', '7.88', '409', '25.7%', '649', '23.3%', '0.35', '0.10'],
        ['48', 'Aria', '9', '377', '8.43', '422', '27.5%', '419', '15.0%', '0.40', '0.20'],
        ['49', 'cody', '6', '334', '7.62', '434', '27.3%', '500', '18.0%', '0.67', '0.15'],
        ['50', 'Farfetch', '16', '223', '0.99', '149', '8.0%', '482', '16.0%', '1.24', '0.26'],
        ['51', 'StarScreen', '9', '351', '7.14', '468', '25.1%', '824', '27.4%', '0.41', '0.24'],
        ['52', 'Ferret', '11', '306', '5.33', '340', '18.2%', '776', '25.8%', '0.39', '0.43'],
        ['53', 'Serin', '12', '378', '8.28', '410', '21.9%', '420', '14.0%', '0.36', '0.07'],
        ['54', 'CarioK', '15', '326', '5.80', '214', '13.0%', '931', '30.0%', '0.46', '0.36'],
        ['55', 'Ackerman', '10', '221', '1.18', '134', '8.4%', '402', '14.5%', '1.39', '0.36'],
        ['56', 'Xiaohu', '3', '546', '9.51', '694', '33.9%', '337', '13.7%', '0.49', '0.22'],
        ['57', 'Xiaobai', '8', '412', '7.65', '356', '17.4%', '300', '12.2%', '0.44', '0.09']
    ],
    'teamT1': [
        ['1', 'RNG', '4.6', '17.1', '12.2', '2009', '55.6%', '29:31', '56469', '1912', '33.9'],
        ['2', 'PSG', '4.4', '15.9', '11.8', '1841', '65.0%', '30:50', '56226', '1822', '33.4'],
        ['3', 'DK', '4.3', '14.9', '11.3', '2110', '46.2%', '30:46', '57332', '1862', '34.1'],
        ['4', 'MAD', '3.5', '15.2', '13.7', '2033', '57.1%', '30:41', '56791', '1850', '33.6'],
        ['5', 'C9', '3.4', '14.8', '13.6', '1875', '31.2%', '32:25', '57943', '1787', '33.7'],
        ['6', 'DFM', '2.9', '12.0', '12.3', '1534', '83.3%', '30:42', '53740', '1749', '32.8'],
        ['7', 'IW', '2.2', '15.2', '21.7', '1871', '33.3%', '32:49', '57406', '1749', '31.4'],
        ['8', 'PNG', '1.8', '11.3', '19.0', '1650', '50.0%', '32:24', '55893', '1724', '31.6'],
        ['9', 'PGG', '1.7', '9.2', '17.5', '1617', '42.1%', '26:26', '43294', '1637', '31.3'],
        ['10', 'INF', '1.6', '8.7', '16.7', '1593', '33.3%', '29:27', '48314', '1640', '32.2'],
        ['11', 'UOL', '1.5', '7.9', '16.7', '1571', '44.4%', '26:33', '43502', '1638', '31.9']
    ],
    'teamT2': [
        ['1', 'RNG', '2.4', '56.0%', '0.8', '65.6%', '3.73', '1.7', '47.9%', '7.2', '3.6'],
        ['2', 'PSG', '2.5', '53.1%', '0.7', '60.9%', '3.73', '1.8', '47.6%', '6.1', '5.2'],
        ['3', 'DK', '2.5', '57.0%', '0.7', '54.3%', '3.85', '1.7', '48.1%', '7.3', '4.2'],
        ['4', 'MAD', '2.2', '52.2%', '0.7', '55.6%', '3.74', '1.7', '46.8%', '7.0', '6.0'],
        ['5', 'C9', '2.9', '61.0%', '0.6', '45.5%', '3.52', '1.6', '44.9%', '5.6', '6.3'],
        ['6', 'DFM', '1.7', '41.7%', '0.8', '55.6%', '3.29', '1.7', '46.5%', '5.7', '5.8'],
        ['7', 'IW', '1.7', '34.5%', '0.2', '11.1%', '2.71', '1.4', '37.1%', '5.2', '9.2'],
        ['8', 'PNG', '2.2', '46.4%', '0.7', '57.1%', '3.55', '1.4', '42.7%', '6.5', '7.3'],
        ['9', 'PGG', '1.6', '44.9%', '0.3', '29.4%', '2.85', '1.2', '37.3%', '2.5', '7.7'],
        ['10', 'INF', '0.8', '21.7%', '0.3', '28.6%', '3.72', '1.5', '43.9%', '2.8', '9.5'],
        ['11', 'UOL', '0.7', '17.6%', '0.2', '25.0%', '2.79', '1.3', '39.5%', '3.2', '7.1']
    ]
}

wanplusmsi = WanPlusMsi()